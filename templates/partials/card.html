<div class="card bg-white rounded-lg shadow-md overflow-hidden border border-gray-200 transition-all duration-300 hover:shadow-xl">
    <!-- Изображение и теги -->
    <div class="relative aspect-square">
        <img src="{{ album.image.url }}" alt="{{ album.name }}" class="mx-auto my-auto object-cover">
        
        <!-- Формат на черном фоне -->
        <span class="absolute bottom-2 left-2 bg-black/80 text-white text-xs font-medium px-2 py-1 rounded-md">
            {{ album.get_format }}
        </span>

        <!-- Предложение недели -->
        {% if album.offer_of_the_week %}
            <span class="absolute top-2 right-2 bg-red-600 text-white text-xs font-semibold px-2.5 py-1 rounded-full">
                Предложение недели
            </span>
        {% endif %}
    </div>

    <!-- Контент -->
    <div class="p-3.5">
        <!-- Артист -->
        <h5 class="text-sm font-medium text-gray-700 hover:text-blue-600 transition-colors duration-300">
            <a href="{{ album.artist.get_absolute_url }}">{{ album.artist.name }}</a>
        </h5>

        <!-- Название альбома -->
        <h5 class="text-lg font-bold text-gray-900 hover:text-blue-600 transition-colors duration-300 line-clamp-2">
            <a href="{{ album.get_absolute_url }}">{{ album.name }}</a>
        </h5>

        <!-- Информация -->
        <ul class="mt-2 space-y-1 text-xs text-gray-600">
            <li>Носитель: {{ album.media_type.name }}</li>
            <li>Дата релиза: {{ album.release_date|date:"d F Y" }}</li>
            <li>Жанр: {{ album.artist.genre.name }}</li>
            <li>
                {% if album.stock %}
                    <span class="text-green-600 font-medium">В наличии ({{ album.stock }} шт.)</span>
                {% else %}
                    <span class="text-red-600 font-medium">Нет в наличии</span>
                {% endif %}
            </li>
        </ul>

        <!-- Цена и кнопки -->
        <div class="mt-4 flex items-center justify-between">
            <!-- Цена из прайс-листа -->
            <span class="text-xl font-bold text-gray-900">{{ album.current_price }} ₽</span>

            <!-- Кнопки -->
            <div class="flex items-center gap-2">
                <!-- Кнопка "В корзину" -->
                {% if request.user.is_authenticated %}
                    {% if album.stock %}
                        {% if album not in cart.products_in_cart %}
                            <a href="{% url 'add_to_cart' ct_model=album.ct_model slug=album.slug %}" class="p-1.5 bg-blue-500 text-white rounded-md hover:bg-blue-600 transition-colors duration-300" title="В корзину">
                                <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
                                </svg>
                            </a>
                        {% else %}
                            <span class="relative p-1.5 bg-gray-200 text-gray-500 rounded-md cursor-not-allowed" title="Уже в корзине">
                                <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
                                </svg>
                                <span class="absolute top-0 right-0 -mt-1 -mr-1 w-3 h-3 bg-green-500 rounded-full flex items-center justify-center">
                                    <svg class="w-2 h-2 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7" />
                                    </svg>
                                </span>
                            </span>
                        {% endif %}
                    {% else %}
                        <span class="p-1.5 bg-gray-200 text-gray-400 rounded-md cursor-not-allowed" title="Нет в наличии">
                            <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
                            </svg>
                        </span>
                    {% endif %}

                    <!-- Кнопка "В избранное" (временно через #) -->
                    {% if album in request.user.customer.favorite.all %}
                        <a href="#" class="p-1.5 bg-red-100 text-red-600 rounded-md hover:bg-red-200 transition-colors duration-300" title="Убрать из избранного">
                            <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12z" />
                            </svg>
                        </a>
                    {% else %}
                        <a href="#" class="p-1.5 bg-gray-100 text-gray-500 rounded-md hover:bg-gray-200 transition-colors duration-300" title="В избранное">
                            <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12z" />
                            </svg>
                        </a>
                    {% endif %}
                {% else %}
                    <!-- Кнопка для неавторизованных -->
                    <a href="{% url 'login' %}" class="p-1.5 bg-blue-500 text-white rounded-md hover:bg-blue-600 transition-colors duration-300" title="Авторизуйтесь">
                        <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 16l-4-4m0 0l4-4m-4 4h14" />
                        </svg>
                    </a>
                {% endif %}
            </div>
        </div>

        <!-- Если нет в наличии и не в wishlist -->
        {% if request.user.is_authenticated and not album.stock and album not in request.user.customer.wishlist.all %}
            <div class="mt-3">
                <a href="{% url 'add_to_wishlist' album_id=album.id %}" class="block w-full bg-gray-100 text-gray-700 px-3 py-1.5 rounded-md hover:bg-gray-200 transition-colors duration-300 text-sm text-center font-medium">
                    Добавить в ожидаемое
                </a>
            </div>
        {% endif %}
    </div>
</div>